<ion-content class="ion-padding container" fullscreen="true">
  <ion-card class="cha-card">
    <ion-card-header>
      <ion-card-title class="TIT">SurveyEngine</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <h2 class="text-center">Cambiando contraseña</h2>
      <h3 class="text-center">
        Email del usuario: {{ changedata.correo }}
      </h3>

      <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
        <!-- Campo de contraseña -->
        <div class="input-container">
          <label class="clave" for="clave">Contraseña</label>
          <ion-item lines="full">
            <span slot="start" class="input-icon">
              <!-- Ícono SVG -->
            </span>
            <ion-input
              type="password"
              formControlName="clave"
              id="clave"
              placeholder="Ingrese su contraseña">
              <ion-input-password-toggle slot="end"></ion-input-password-toggle>
            </ion-input>
          </ion-item>
        </div>

        <label for="confirmarclave">Confirmar Contraseña</label>
        <ion-item lines="full">
          <span slot="start" class="input-icon">
            <!-- Ícono SVG -->
          </span>
          <ion-input
            type="password"
            formControlName="confirmarclave"
            id="confirmarclave"
            placeholder="Confirme su contraseña">
            <ion-input-password-toggle slot="end"></ion-input-password-toggle>
          </ion-input>
        </ion-item>


        <!-- Código de verificación -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Código de verificación: {{ generatedCode }}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <form [formGroup]="verificationForm">
            <ion-item>
              <ion-label position="floating">Ingrese el código</ion-label>
              <ion-input formControlName="enteredCode" type="text" style="text-align: center;"></ion-input>
            </ion-item>
          </form>
        </ion-card-content>
      </ion-card>

      
        <!-- Botón de cambiar contraseña -->
        <ion-button type="submit" expand="block" class="chan-button"
          [disabled]="!passwordForm.valid || !isCodeValid()" 
          [size]="'compact'">
          Cambiar contraseña
        </ion-button>
      </form>
    </ion-card-content> 
  </ion-card>


<!-- Alerta de carga -->
<ion-alert
  *ngIf="loadingAlertVisible"
  header="Cargando..."
  message="Estamos procesando tu solicitud"
  [buttons]="[]"
  [isOpen]="loadingAlertVisible"
></ion-alert>

<!-- Alerta de éxito -->
<ion-alert
  *ngIf="successAlertVisible"
  header="¡Éxito!"
  message="La contraseña se ha cambiado correctamente."
  [buttons]="['Aceptar']"
  [isOpen]="successAlertVisible"
  (didDismiss)="successAlertVisible = false"
></ion-alert>

<!-- Alerta de error -->
<ion-alert
  *ngIf="errorAlertVisible"
  header="Error"
  message="Hubo un problema al cambiar la contraseña. Intenta de nuevo."
  [buttons]="['Aceptar']"
  [isOpen]="errorAlertVisible"
  (didDismiss)="errorAlertVisible = false"
></ion-alert>

<!-- Alerta de contraseñas no coinciden -->
<ion-alert
  *ngIf="mismatchAlertVisible"
  header="Error"
  message="Las contraseñas no coinciden. Por favor, intenta de nuevo."
  [buttons]="['Aceptar']"
  [isOpen]="mismatchAlertVisible"
  (didDismiss)="mismatchAlertVisible = false"
></ion-alert>

<!-- Alerta de formulario inválido -->
<ion-alert
  *ngIf="formErrorAlertVisible"
  header="Formulario inválido"
  message="Por favor, completa todos los campos correctamente."
  [buttons]="['Aceptar']"
  [isOpen]="formErrorAlertVisible"
  (didDismiss)="formErrorAlertVisible = false"
></ion-alert>

</ion-content>